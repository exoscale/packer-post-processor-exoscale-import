# Packer Post-Processor plugin: Exoscale Import

[![Actions Status](https://github.com/exoscale/packer-post-processor-exoscale-import/workflows/CI/badge.svg)](https://github.com/exoscale/packer-post-processor-exoscale-import/actions?query=workflow%3ACI)

> **IMPORTANT: this project has been superseded by the [multi-component Exoscale plugin](https://github.com/exoscale/packer-plugin-exoscale), and will not be updated anymore.**

The `exoscale-import` post-processor plugin can be used with HashiCorp
[Packer][packer] to take an image artifact from the *QEMU*, *Artifice*, or
*File* builders and import it to Exoscale as a new
[Compute instance template][customtemplatesdoc].


## Installation

### Using pre-built releases

You can find pre-built [releases][releases] of the plugin here. Once you have
downloaded the latest archive corresponding to your target OS, uncompress it
to retrieve the `packer-post-processor-exoscale-import` plugin binary file.


### From Sources

If you prefer to build the plugin from sources, clone the GitHub repository
locally and run the command `make build` from the root of the sources
directory. Upon successful compilation, a
`packer-post-processor-exoscale-import` plugin binary file can be found in the
`bin/` directory.


## Configuration

To use the plugin with Packer, please follow the official documentation on
[installing a Packer plugin][packerplugindoc].

Here is the list of supported configuration parameters by the post-processor.


### Required parameters

There are some configuration options available for the post-processor.

Required:

- `api_key` (string) - The API key used to communicate with Exoscale
  services. This may also be set using the `EXOSCALE_API_KEY` environmental
  variable.

- `api_secret` (string) - The API secret used to communicate with Exoscale
  services. This may also be set using the `EXOSCALE_API_SECRET`
  environmental variable.

- `image_bucket` (string) - The name of the bucket in which to upload the
  template image to SOS. The bucket must exist when the post-processor is
  run.

- `template_zone` (string) - The Exoscale [zone][zones] in which to register
  the template.

- `template_name` (string) - The name to be used for registering the template.


### Optional parameters

- `api_endpoint` (string) - The API endpoint used to communicate with the
  Exoscale API. Defaults to `https://api.exoscale.com/v1`.

- `sos_endpoint` (string) - The endpoint used to communicate with SOS.
  Defaults to `https://sos-<template_zone>.exo.io`.

- `template_description` (string) - The description of the registered template.

- `template_username` (string) - An optional username to be used to log into
  Compute instances using this template.

- `template_boot_mode` (string) - The template boot mode. Supported values: `legacy` (default), `uefi`.

- `template_disable_password` (boolean) - Whether the registered template
  should disable Compute instance password reset. Defaults to `false`.

- `template_disable_sshkey` (boolean) - Whether the registered template
  should disable SSH key installation during Compute instance creation.
  Defaults to `false`.

- `skip_clean` (boolean) - Whether we should skip removing the image file
  uploaded to SOS after the import process has completed. "true" means that
  we should leave it in the bucket, "false" means deleting it.
  Defaults to `false`.


## Usage

Here is an example of a simple Packer configuration using the `exoscale-import`
post-processor to upload a disk image artifact generated by the `qemu` builder:

```json
{
  "variables": {
    "exoscale_api_key": "{{env `EXOSCALE_API_KEY`}}",
    "exoscale_api_secret": "{{env `EXOSCALE_API_SECRET`}}"
  },
  "builders": [{
    "type": "qemu",
    ...
  }],
  "post-processors": [{
    "type": "exoscale-import",
    "api_key": "{{user `exoscale_api_key`}}",
    "api_secret": "{{user `exoscale_api_secret`}}",
    "image_bucket": "my-templates",
    "template_name": "hello",
    "template_description": "My hello application",
    "template_username": "ubuntu"
  }]
}
```


## Contributing

* If you think you've found a bug in the code or you have a question regarding
  the usage of this software, please reach out to us by opening an issue in
  this GitHub repository.
* Contributions to this project are welcome: if you want to add a feature or a
  fix a bug, please do so by opening a Pull Request in this GitHub repository.
  In case of feature contribution, we kindly ask you to open an issue to
  discuss it beforehand.


[customtemplatesdoc]: https://community.exoscale.com/documentation/compute/custom-templates/
[packer]: https://www.packer.io/
[releases]: https://github.com/exoscale/packer-builder-exoscale/releases
[zones]: https://www.exoscale.com/datacenters
